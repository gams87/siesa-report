{% extends base_template %}
{% load partials %}

{% block content %}

<!-- Page Header -->
{% include "components/page_header.html" with title="Configuración de Reportes" subtitle="Gestiona y configura los reportes" %}

{% if messages %}
    {% for message in messages %}
        {% include "components/alert.html" with alert_type=message.tags message=message %}
    {% endfor %}
{% endif %}

<div class="flex justify-end gap-2 mb-4">
    <button hx-get="{% url 'config-report-sync' %}" hx-trigger="click" hx-target="this" hx-swap="none" class="btn btn-outline btn-sm">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path>
        </svg>
        Sync datos
    </button>
    <button class="btn btn-outline btn-sm" hx-get="{% url 'config-report-detail' %}" hx-swap="innerHTML">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        Agregar
    </button>
</div>

<!-- Table -->
 {% partialdef table-section inline %}
    <article id="table-data" hx-get="{% url 'config-report' %}" hx-trigger="updateTable from:body" hx-swap="innerHTML">
    <!-- Results Info -->
    <div class="flex justify-between items-center mb-4">
        <div class="text-sm text-base-content/70">
            Total de registros: <span class="font-semibold">{{ page.paginator.count }}</span>
        </div>
        <div class="flex items-center gap-2">
            <label class="text-sm">Registros por página:</label>
            <select class="select select-bordered select-sm w-auto"
                hx-get="{% url 'config-report' %}" hx-trigger="change" name="page_size" hx-indicator="#loading-overlay">
                <option value="10" {% if page.paginator.per_page == 10 %}selected{% endif %}>10</option>
                <option value="25" {% if page.paginator.per_page == 25 %}selected{% endif %}>25</option>
                <option value="50" {% if page.paginator.per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if page.paginator.per_page == 100 %}selected{% endif %}>100</option>
                <option value="200" {% if page.paginator.per_page == 200 %}selected{% endif %}>200</option>
            </select>
        </div>
    </div>
    <div class="card bg-base-100 shadow-xl relative" hx-indicator="#loading-overlay">
        <div class="card-body p-0">
            <div class="overflow-x-auto">
                <table class="table table-zebra table-pin-rows">
                    <thead>
                        <tr>
                            <th class="bg-base-200">Reporte</th>
                            <th class="bg-base-200">Tabla</th>
                            <th class="bg-base-200">Orientación</th>
                            <th class="bg-base-200">Creado el</th>
                            <th class="bg-base-200">Actualizado el</th>
                            <th class="bg-base-200">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for report in page.object_list %}
                            <tr class="hover">
                                <td>
                                    {{ report.name }}
                                </td>
                                <td>
                                    <div class="badge badge-outline badge-sm">{{ report.table }}</div>
                                </td>
                                <td>
                                    <div class="badge badge-outline badge-sm">{{ report.orientation }}</div>
                                </td>
                                <td>
                                    {{ report.created_at }}
                                </td>
                                <td>
                                    {{ report.updated_at }}
                                </td>
                                <td>
                                    <div class="flex gap-2">
                                        <button class="btn btn-sm btn-outline" hx-get="{% url 'config-report-detail' %}?report_id={{ report.id }}">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            Editar
                                        </button>
                                        <button class="btn btn-sm btn-error"
                                            hx-delete="{% url 'config-report-delete' report.id %}"
                                            hx-confirm="Eliminar configuración del reporte {{ report.name }}">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                            Eliminar
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-base-content/70 py-6">
                                    <p>No hay datos disponibles.</p>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% include "components/loading.html" %}
    </div>

    <!-- Pagination -->
    {% if page.has_other_pages %}
        <div class="flex justify-center mt-4" hx-push-url="true" hx-target="#table-data" hx-indicator="#loading-overlay">
            <div class="join">
                {% if page.has_previous %}
                    <button class="join-item btn" hx-get="?page=1&page_size={{ page.paginator.per_page }}" >«</button>
                    <button class="join-item btn" hx-get="?page={{ page.previous_page_number }}&page_size={{ page.paginator.per_page }}">‹</button>
                {% else %}
                    <button class="join-item btn btn-disabled">«</button>
                    <button class="join-item btn btn-disabled">‹</button>
                {% endif %}
                    <button class="join-item btn" btn-active>Página {{ page.number }} de {{ page.paginator.num_pages }}</button>
                {% if page.has_next %}
                    <button class="join-item btn" hx-get="?page={{ page.next_page_number }}&page_size={{ page.paginator.per_page }}">›</button>
                    <button class="join-item btn" hx-get="?page={{ page.paginator.num_pages }}&page_size={{ page.paginator.per_page }}">»</button>
                {% else %}
                    <button class="join-item btn btn-disabled">›</button>
                    <button class="join-item btn btn-disabled">»</button>
                {% endif %}
            </div>
        </div>
    {% endif %}
</article>
{% endpartialdef %}

{% endblock %}